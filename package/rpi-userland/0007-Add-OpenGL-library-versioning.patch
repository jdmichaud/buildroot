From bf388550943afc70798c497e3fc706303394cfdc Mon Sep 17 00:00:00 2001
From: =?utf-8?q?Ga=C3=ABl=20PORTAY?= <gael.portay@savoirfairelinux.com>
Date: Fri, 3 Mar 2017 17:28:41 -0500
Subject: [PATCH] Add OpenGL library versioning

Some applications like QtWebEngine dynamically load libraries using
dlopen. The library name is hardcoded, and it includes the library
version [1].

This patch creates symlinks for EGL and GLES libraries.

	libEGL.so.1 -> libEGL.so
	libGLESv2.so.2 -> libGLESv2.so

[1] https://github.com/qt/qtwebengine/blob/v5.8.0/src/core/surface_factory_qt.cpp#L76-L86

Signed-off-by: GaÃ«l PORTAY <gael.portay@savoirfairelinux.com>
---
 host_applications/android/apps/vidtex/CMakeLists.txt | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/host_applications/android/apps/vidtex/CMakeLists.txt b/host_applications/android/apps/vidtex/CMakeLists.txt
index 1f705ef..d68ae5f 100644
--- a/host_applications/android/apps/vidtex/CMakeLists.txt
+++ b/host_applications/android/apps/vidtex/CMakeLists.txt
@@ -10,3 +10,8 @@ set (VIDTEX_SOURCES
    vidtex.c)
 add_executable(vidtex ${VIDTEX_SOURCES})
 target_link_libraries(vidtex GLESv2 EGL m bcm_host mmal_core mmal_components mmal_util mmal_vc_client vcos)
+
+set(DESTDIR \$ENV{DESTDIR})
+include(GNUInstallDirs)
+install(CODE "execute_process(COMMAND ${CMAKE_COMMAND} -E create_symlink libEGL.so ${DESTDIR}/${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}/libEGL.so.1)")
+install(CODE "execute_process(COMMAND ${CMAKE_COMMAND} -E create_symlink libGLESv2.so ${DESTDIR}/${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}/libGLESv2.so.2)")
-- 
2.12.1

